<p-dialog
  [header]="'DIALOG.MENU.HEADER.' + changeMode | translate"
  [(visible)]="displayDetailDialog"
  (onHide)="onCloseDetailDialog()"
  [breakpoints]="{ '1330px': '60vw', '1230px': '70vw', '1130px': '80vw', '930px': '90vw', '830px': '100vw' }"
  styleClass="overflow-auto"
  [style]="{ width: '52vw' }"
  [modal]="true"
  [draggable]="true"
  [resizable]="true"
  [contentStyle]="{ overflow: 'visible' }"
>
  <p-tabView #panelDetail [(activeIndex)]="tabIndex" (onChange)="onTabPanelChange($event)">
    <p-tabPanel
      [header]="'DIALOG.MENU.TABS.DETAILS' | translate"
      [tooltip]="'DIALOG.MENU.TABS.DETAILS.TOOLTIP' | translate"
    >
      <form [formGroup]="formGroup" errorTailor>
        <div class="grid">
          <div
            class="col-12 md:col-12 my-1"
            style="min-width: 15rem"
            [title]="'MENU_ITEM.TOOLTIP.MENU_NAME' | translate"
          >
            <span class="p-float-label" controlErrorAnchor>
              <input
                pInputText
                type="text"
                id="workspace_menu_detail_field_menu_name"
                class="w-full pt-3 pb-2"
                formControlName="name"
              />
              <label class="ocx-required-label" for="workspace_menu_detail_field_menu_name">
                {{ 'MENU_ITEM.MENU_NAME' | translate }}
              </label>
            </span>
          </div>

          <div class="col-12 md:col-6 my-1" style="min-width: 15rem" [title]="'MENU_ITEM.TOOLTIP.MENU_ID' | translate">
            <span class="p-float-label" controlErrorAnchor>
              <input
                pInputText
                type="text"
                id="workspace_menu_detail_field_menu_id"
                class="w-full pt-3 pb-2"
                formControlName="key"
              />
              <label class="ocx-required-label" for="workspace_menu_detail_field_menu_id">
                {{ 'MENU_ITEM.MENU_ID' | translate }}
              </label>
            </span>
          </div>
          <div
            class="col-12 md:col-6 my-1"
            style="min-width: 15rem"
            [title]="'MENU_ITEM.TOOLTIP.PARENT_ID' | translate"
          >
            <span class="p-float-label">
              <p-dropdown
                id="workspace_menu_detail_field_parent_id"
                styleClass="w-full input-field-correction"
                formControlName="parentItemId"
                [options]="parentItems"
              >
              </p-dropdown>
              <label for="workspace_menu_detail_field_parent_id"> {{ 'MENU_ITEM.PARENT_ID' | translate }} </label>
            </span>
          </div>

          <div class="col-12 my-1" [title]="'MENU_ITEM.TOOLTIP.URL' | translate">
            <span class="p-float-label mb-1" controlErrorAnchor>
              <p-autoComplete
                #mfeUrl
                formControlName="url"
                [suggestions]="filteredMfes"
                (completeMethod)="onFilterPaths($event)"
                (onKeyUp)="onKeyUpUrl($event)"
                (onFocus)="onFocusUrl(mfeUrl)"
                (onClear)="onClearUrl()"
                (onDropdownClick)="onDropdownClick(mfeUrl)"
                [minLength]="0"
                styleClass="w-full"
                field="mfePath"
                [dropdown]="true"
                [dropdownMode]="'current'"
                [completeOnFocus]="true"
                [showClear]="true"
              >
                <ng-template let-mfe pTemplate="item">
                  <div
                    class="flex flex-row column-gap-2 align-items-center"
                    [class.empty-dropdown-list-entry]="mfe.appId === '$$$-empty'"
                  >
                    <div class="hidden md:block w-35rem">{{ limitText(mfe.mfePath, 80) }}</div>
                    <div class="block md:hidden w-25rem">{{ limitText(mfe.mfePath, 50) }}</div>
                    <div class="flex flex-column">
                      <div class="text-sm font-bold" [class.danger-action-text]="!mfe.id">
                        {{ mfe.id ? mfe.product : (mfe.product | translate) }}
                      </div>
                      <div class="text-xs" *ngIf="mfe.id">{{ mfe.appId }}</div>
                    </div>
                  </div>
                </ng-template>
              </p-autoComplete>
              <label for="workspace_menu_detail_field_url"> {{ 'MENU_ITEM.URL' | translate }} </label>
            </span>
          </div>

          <div class="col-12 md:col-2 my-1" [title]="'Position'">
            <span class="p-float-label mb-1" controlErrorAnchor>
              <input
                pInputText
                type="text"
                id="workspace_menu_detail_field_position"
                class="w-full pt-3 pb-2"
                formControlName="position"
              />
              <label for="workspace_menu_detail_field_position">Position</label>
            </span>
          </div>
          <div class="col-12 md:col-4 my-1" style="min-width: 10rem" [title]="'MENU_ITEM.TOOLTIP.BADGE' | translate">
            <span class="p-float-label mb-1" controlErrorAnchor>
              <p-dropdown
                id="workspace_menu_detail_field_badge"
                styleClass="w-full min-w-min input-field-correction"
                formControlName="badge"
                [options]="iconItems"
              >
                <ng-template let-ico pTemplate="selectedItem">
                  <div class="flex">
                    <span class="pi pi-{{ ico.value }} mr-3"> </span>
                    <span>{{ ico.label || 'dummy-for-renderer' }}</span>
                  </div>
                </ng-template>
                <ng-template let-ico pTemplate="item">
                  <div class="flex">
                    <span class="pi pi-{{ ico.value }} mr-3"> </span>
                    <span>{{ ico.label }}</span>
                  </div>
                </ng-template>
              </p-dropdown>
              <label for="workspace_menu_detail_field_badge"> {{ 'MENU_ITEM.BADGE' | translate }} </label>
            </span>
          </div>
          <div class="col-12 md:col-3 my-1" style="min-width: 10rem" [title]="'MENU_ITEM.TOOLTIP.SCOPE' | translate">
            <span class="p-float-label mb-1" controlErrorAnchor>
              <p-dropdown
                id="workspace_menu_detail_field_scope"
                styleClass="w-full min-w-min input-field-correction"
                formControlName="scope"
                [options]="scopeItems"
              >
              </p-dropdown>
              <label for="workspace_menu_detail_field_scope"> {{ 'MENU_ITEM.SCOPE' | translate }} </label>
            </span>
          </div>

          <div
            class="col-12 md:col-3 my-1 md:pl-5 flex justify-content-start"
            [title]="'MENU_ITEM.TOOLTIP.DISABLED' | translate"
          >
            <p-checkbox
              id="workspace_menu_detail_field_disabled"
              class="checkbox-label"
              formControlName="disabled"
              [label]="'MENU_ITEM.DISABLED' | translate"
              [binary]="true"
            >
            </p-checkbox>
          </div>

          <div class="col-12 md:col-9 my-1" [title]="'MENU_ITEM.TOOLTIP.DESCRIPTION' | translate">
            <span class="p-float-label mb-1" controlErrorAnchor>
              <input
                pInputText
                type="text"
                id="workspace_menu_detail_field_description"
                class="w-full pt-3 pb-2"
                formControlName="description"
              />
              <label for="workspace_menu_detail_field_description"> {{ 'MENU_ITEM.DESCRIPTION' | translate }} </label>
            </span>
          </div>
          <div
            class="col-12 md:col-3 my-1 md:pl-5 flex justify-content-start"
            [title]="'MENU_ITEM.TOOLTIP.EXTERN' | translate"
          >
            <p-checkbox
              id="workspace_menu_detail_field_workspace_exit"
              class="checkbox-label"
              formControlName="external"
              [label]="'MENU_ITEM.EXTERN' | translate"
              [binary]="true"
            >
            </p-checkbox>
          </div>
        </div>
      </form>
    </p-tabPanel>

    <p-tabPanel
      [header]="'DIALOG.MENU.TABS.I18N.LABEL' | translate"
      [tooltip]="'DIALOG.MENU.TABS.I18N.TOOLTIP' | translate"
    >
      <div class="mt-3 mb-1 flex flex-column gap-4">
        <span class="p-float-label p-input-icon-right w-30rem" *ngFor="let language of languagesDisplayed; index as i">
          <i
            class="pi pi-times"
            (click)="onRemoveLanguage(language.value)"
            [title]="'DIALOG.MENU.TABS.I18N.REMOVE_LANGUAGE' | translate"
          ></i>
          <input
            pInputText
            type="text"
            [id]="'i18n_' + language.value"
            class="w-30rem pt-3 pb-2"
            [(ngModel)]="language.data"
          />
          <label [for]="'i18n_' + language.value"> {{ getLanguageLabel(language.value) }} </label>
        </span>
      </div>
      <div class="flex align-items-center column-gap-4 row-gap-2 mt-4" *ngIf="languagesAvailable.length > 0">
        <div class="data-view-control opacity-90 text-sm w-4rem">
          {{ 'DIALOG.MENU.TABS.I18N.ADD_LANGUAGE' | translate }}
        </div>
        <p-selectButton
          inputid="i18n_language_selector"
          styleClass="data-view-control opacity-90"
          [options]="languagesAvailable"
          (onOptionClick)="onAddLanguage($event.option.value)"
          [title]="'DIALOG.MENU.TABS.I18N.ADD_LANGUAGE' | translate"
        >
        </p-selectButton>
      </div>
    </p-tabPanel>

    <p-tabPanel
      [disabled]="changeMode === 'CREATE'"
      [header]="'DIALOG.MENU.TABS.INTERN' | translate"
      [tooltip]="'DIALOG.MENU.TABS.INTERN.TOOLTIP' | translate"
    >
      <app-menu-intern [menuItem]="menuItem" [dateFormat]="dateFormat"></app-menu-intern>
    </p-tabPanel>
  </p-tabView>
  <ng-template pTemplate="footer">
    <div class="flex flex-wrap gap-2 justify-content-end">
      <p-button
        icon="pi pi-times"
        styleClass="m-0"
        (click)="onCloseDetailDialog()"
        [label]="'ACTIONS.CANCEL' | translate"
        [title]="'ACTIONS.TOOLTIPS.CANCEL_WITHOUT_SAVE' | translate"
      ></p-button>
      <p-button
        icon="pi pi-save"
        styleClass="m-0"
        (onClick)="onMenuSave()"
        [disabled]="!formGroup.valid"
        [label]="'ACTIONS.SAVE' | translate"
        [title]="'ACTIONS.TOOLTIPS.SAVE' | translate"
      ></p-button>
    </div>
  </ng-template>
</p-dialog>

<!-- DELETE MENU ITEM -->
<p-dialog
  [header]="'DIALOG.MENU.HEADER.DELETE' | translate"
  [(visible)]="displayDeleteDialog"
  (onHide)="onCloseDetailDialog()"
  [modal]="true"
  [closable]="true"
  [resizable]="false"
  [dismissableMask]="true"
  [style]="{ 'max-width': '425px' }"
>
  <div class="my-2 flex column-gap-4 row-gap-1 justify-content-start align-items-center">
    <div class="pi pi-question-circle text-3xl danger-action-text"></div>
    <div>
      <div class="font-bold">{{ ('ACTIONS.DELETE.MESSAGE' | translate).replace('{{ITEM}}', menuItemName) }}</div>
      <div class="mt-2">{{ 'ACTIONS.DELETE.MENU_MESSAGE' | translate }}</div>
      <div class="mt-2">{{ 'ACTIONS.DELETE.MESSAGE_INFO' | translate }}</div>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <div class="mt-3 flex flex-wrap column-gap-2 row-gap-1 justify-content-end">
      <button
        pButton
        type="button"
        class="m-0"
        icon="pi pi-times"
        iconPos="left"
        [label]="'ACTIONS.CONFIRMATION.NO' | translate"
        (click)="onCloseDeleteDialog()"
      ></button>
      <button
        pButton
        type="button"
        class="m-0"
        icon="pi pi-check"
        iconPos="left"
        [label]="'ACTIONS.CONFIRMATION.YES' | translate"
        (click)="onMenuDelete()"
      ></button>
    </div>
  </ng-template>
</p-dialog>
